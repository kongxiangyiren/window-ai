(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const e of o)if(e.type==="childList")for(const a of e.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const e={};return o.integrity&&(e.integrity=o.integrity),o.referrerPolicy&&(e.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?e.credentials="include":o.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function t(o){if(o.ep)return;o.ep=!0;const e=n(o);fetch(o.href,e)}})();const v="window-ai",V=[self.location.hostname,"unpkg.com"],g=s=>{const l=Date.now(),n=new URL(s.url);return n.protocol=self.location.protocol,n.hostname===self.location.hostname&&(n.search+=(n.search?"&":"?")+"cache-bust="+l),n.href};self.addEventListener("activate",s=>{s.waitUntil(self.clients.claim())});self.addEventListener("fetch",s=>{if(V.indexOf(new URL(s.request.url).hostname)>-1){const l=caches.match(s.request),n=g(s.request),t=fetch(n,{cache:"no-store"}),o=t.then(e=>e.clone());s.respondWith(Promise.race([t.catch(e=>l),l]).then(e=>e||t).catch(e=>{})),s.waitUntil(Promise.all([o,caches.open(v)]).then(([e,a])=>e.ok&&a.put(s.request,e)).catch(e=>{}))}});const w={class:"container ivu-p"},_={class:"dialog"},x={class:"dialog-item-main"},y={class:"question ivu-mt"},C=Vue.defineComponent({__name:"App",setup(s){const l=Vue.ref(""),n=Vue.ref(!1),t=Vue.ref([]),o=Vue.ref(!0),e=Vue.ref(null);Vue.onMounted(async()=>{if(!window.ai){console.log("不支持AI功能, 请在支持AI功能的浏览器中打开,chrome dev 下载：https://www.google.cn/intl/zh-CN/chrome/dev/next-steps.html 详情参考：https://juejin.cn/post/7384997062415843339#heading-2"),t.value.push({id:t.value.length+1,role:"ai",text:"不支持AI功能, 请在支持AI功能的浏览器中打开,chrome dev 下载：https://www.google.cn/intl/zh-CN/chrome/dev/next-steps.html 详情参考：https://juejin.cn/post/7384997062415843339#heading-2"});return}const c=await window.ai.canCreateTextSession();if(c==="readily")console.log("模型已经准备好了"),e.value=window.ai.createTextSession(),o.value=!1;else if(c==="after-download"){console.log("模型正在下载中"),t.value.push({id:t.value.length+1,role:"ai",text:"模型正在下载中"});return}else{console.log("模型还没下载,详情参考：https://juejin.cn/post/7384997062415843339#heading-2"),t.value.push({id:t.value.length+1,role:"ai",text:"模型还没下载,详情参考：https://juejin.cn/post/7384997062415843339#heading-2"});return}});async function a(){if(n.value||l.value==="")return;n.value=!0;const c=l.value;l.value="",t.value.push({id:t.value.length+1,role:"me",text:c});const r=t.value.length+1;t.value.push({id:r,role:"ai",text:"AI 思考中..."});const d=t.value.find(u=>u.id===r);if(!e.value){console.log("session 不存在");return}console.log(t.value,"dialogs.value");const h=(await e.value).promptStreaming(c);d.text="";let p=0;for await(const u of h){const i=u.slice(p);p=u.length,d.text+=i}console.log(d.text),n.value=!1}async function f(){if(t.value=[],!e.value){console.log("session 不存在");return}(await e.value).destroy(),e.value=window.ai.createTextSession()}return(c,r)=>{const d=Vue.resolveComponent("Input"),h=Vue.resolveComponent("Button"),p=Vue.resolveComponent("Col"),u=Vue.resolveComponent("Row");return Vue.openBlock(),Vue.createElementBlock("div",w,[Vue.createElementVNode("div",_,[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(t.value,(i,m)=>(Vue.openBlock(),Vue.createElementBlock("div",{key:m,class:Vue.normalizeClass(["dialog-item",{"dialog-item-me":i.role==="me","dialog-item-ai":i.role==="ai"}])},[Vue.createElementVNode("div",x,Vue.toDisplayString(i.text),1)],2))),128))]),Vue.createElementVNode("div",y,[Vue.createVNode(d,{modelValue:l.value,"onUpdate:modelValue":r[0]||(r[0]=i=>l.value=i),type:"textarea",autosize:{minRows:4,maxRows:6},placeholder:"输入你的问题"},null,8,["modelValue"]),Vue.createVNode(u,{class:"ivu-mt"},{default:Vue.withCtx(()=>[Vue.createVNode(p,null,{default:Vue.withCtx(()=>[Vue.createVNode(h,{type:"primary",size:"large",icon:"md-send",disabled:o.value,loading:n.value,onClick:a},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 发送 ")]),_:1},8,["disabled","loading"])]),_:1}),Vue.createVNode(p,null,{default:Vue.withCtx(()=>[Vue.createVNode(h,{size:"large",class:"ivu-ml",icon:"md-add",disabled:n.value||o.value,onClick:f},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 新对话 ")]),_:1},8,["disabled"])]),_:1})]),_:1})])])}}}),N=(s,l)=>{const n=s.__vccOpts||s;for(const[t,o]of l)n[t]=o;return n},I=N(C,[["__scopeId","data-v-1f47dba0"]]);console.log();Vue.createApp(I).use(ViewUIPlus).mount("#app");
